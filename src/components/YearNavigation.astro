---
interface Props {
    sortedYears: Array<{
        year: number;
        count: number;
        activityCount: number;
        months: number[];
    }>;
}

const { sortedYears } = Astro.props;
---

<div>
    <div
        class="bg-white dark:bg-[#121812] border border-slate-200 dark:border-slate-800 rounded-xl p-4"
    >
        <div class="space-y-2" id="year-navigation">
            {
                sortedYears.map((yearData) => (
                    <div class="year-item">
                        <button
                            class="year-btn w-full text-left px-3 py-2 rounded-lg text-sm font-medium transition-colors hover:bg-slate-100 dark:hover:bg-slate-800"
                            data-year={yearData.year}
                        >
                            <div class="flex items-center justify-between">
                                <span>{yearData.year}</span>
                                <div class="flex items-center gap-2">
                                    <div class="activity-dots flex gap-0.5">
                                        {Array.from(
                                            {
                                                length: Math.min(
                                                    10,
                                                    Math.ceil(
                                                        Math.sqrt(
                                                            yearData.activityCount / 2.5,
                                                        ),
                                                    ),
                                                ),
                                            },
                                            (_, i) => (
                                                <div class="w-1 h-1 bg-slate-300 dark:bg-slate-600 rounded-full" />
                                            ),
                                        )}
                                    </div>
                                    <span class="text-xs text-slate-500">
                                        {yearData.count}
                                    </span>
                                </div>
                            </div>
                        </button>
                        <div class="month-submenu hidden ml-4 mt-1 space-y-1">
                            {yearData.months.map((month) => (
                                <button
                                    class="month-btn w-full text-left px-3 py-1 rounded text-xs text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"
                                    data-month={new Date(yearData.year, month).toLocaleDateString("en-US", {
                                        year: "numeric",
                                        month: "long",
                                    })}
                                    data-year={yearData.year}
                                >
                                    {new Date(
                                        yearData.year,
                                        month,
                                    ).toLocaleDateString("en-US", {
                                        month: "long",
                                    })}
                                </button>
                            ))}
                        </div>
                    </div>
                ))
            }
        </div>
    </div>
</div>

<style>
    .year-btn.active {
        background-color: #059669; /* emerald-600 */
        color: white;
        border-color: #0f172a !important;
    }
    .year-btn.active span.text-slate-500 {
        color: rgba(255, 255, 255, 0.9);
    }
    .year-btn.active .activity-dots div {
        background-color: rgba(255, 255, 255, 0.4);
    }
    :global(.dark) .year-btn.active {
        background-color: #10b981; /* emerald-500 */
        border-color: #0f172a !important;
    }
</style>
